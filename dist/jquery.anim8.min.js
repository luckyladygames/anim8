// Generated by CoffeeScript 1.3.3
/*
v: 0.0.2 alpha
*/(function(){var e,t,n,r=[].slice;(function(){var e,t,n,r,i;if(window.requestAnimationFrame)return;e=0,n=["ms","moz","webkit","o"];for(r=0,i=n.length;r<i;r++){t=n[r];if(window.requestAnimationFrame!=null)break;window.requestAnimationFrame=window[""+t+"RequestAnimationFrame"],window.cancelAnimationFrame=window[""+t+"CancelAnimationFrame"]||window[""+t+"CancelRequestAnimationFrame"]}return window.requestAnimationFrame==null&&(window.requestAnimationFrame=function(t,n){var r,i,s;return r=(new Date).getTime(),s=Math.max(0,16-(r-e)),i=window.setTimeout(function(){return t(r+s)},s),e=r+s,i}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){return clearTimeout(e)}),null})(),e=jQuery,t={cache:{},loadSheet:function(t){var n,r,i=this;return this.cache[t]==null&&(n=e.Deferred(),this.cache[t]=n.promise(),r=new Image,r.src=t,r.onload=function(){return n.resolve(r)},r.onerror=function(){return n.reject(t)},r.onabort=function(){return n.reject(t)}),this.cache[t]},loadIndex:function(t){var n;return this.cache[t]||(n=e.Deferred(),this.cache[t]=n.promise(),e.getJSON(t).done(function(e){return n.resolve(e)}).fail(function(e){return n.reject(e)})),this.cache[t]}},n={init:function(n){return this.each(function(){var r,i;r=e(this);if(r.data("anim8"))return;return i=e.extend({time:1,loop:"infinite",play:!0,offsetX:0,offsetY:0,index:null,sheet:null},n),r.data("index")!=null&&(i.index=r.data("index")),r.data("sheet")!=null&&(i.sheet=r.data("sheet")),r.data("time")!=null&&(i.time=parseFloat(r.data("time"))),r.data("offset-x")!=null&&(i.offsetX=parseInt(r.data("offset-x"))),r.data("offset-y")!=null&&(i.offsetY=parseInt(r.data("offset-y"))),r.data("loop")!=null&&(i.loop=parseInt(r.data("loop"))),console.log(i),i.index==null?e.error("No animation index"):i.sheet==null?e.error("No animation sheet"):e.when(t.loadSheet(i.sheet),t.loadIndex(i.index)).done(function(e,t){var n;return n={state:"none",curFrame:0,lastTime:0,frameCount:t.frames.length,frameDelay:i.time*1e3/t.frames.length,loopsRemaining:i.loop,sheet:e,index:t,offsetX:i.offsetX,offsetY:i.offsetY},r.data("anim8",n),i.play===!0&&(n.state="play"),r.anim8("draw")})})},getData:function(){return e(this).data("anim8")},start:function(t){return t==null&&(t="infinite"),this.each(function(){var n;return n=e(this).anim8("getData"),n.state="play",n.loopsRemaining=t,e(this).anim8("draw")})},stop:function(){return this.each(function(){return e(this).anim8("getData").state="stop",e(this)})},reset:function(){return this.each(function(){return e(this).anim8("getData").curFrame=0,e(this).anim8("draw",!0)})},draw:function(){return this.each(function(){var t,n,r,i,s;return t=e(this),s=t.data("anim8"),r=t.get(0),i=r.getContext("2d"),n=function(e){var o,u,a;if(s.lastTime>0&&e-s.lastTime<s.frameDelay){window.requestAnimationFrame(n);return}if(s.loopsRemaining!=="infinite"&&s.curFrame%s.frameCount===s.frameCount-1){s.loopsRemaining-=1;if(s.loopsRemaining===0)return s.state="stop",t}o=s.curFrame%s.frameCount,a=s.index.frames[o],u=a.spriteSourceSize,i.clearRect(0,0,r.width,r.height),i.drawImage(s.sheet,a.frame.x,a.frame.y,a.frame.w,a.frame.h,s.offsetX+u.x,s.offsetY+u.y,a.frame.w,a.frame.h),s.lastTime=e,s.curFrame+=1;if(s.state==="play")return window.requestAnimationFrame(n)},window.requestAnimationFrame(n)})}},e.fn.anim8=function(){var t,i;return i=arguments[0],t=2<=arguments.length?r.call(arguments,1):[],n[i]!=null?n[i].apply(this,t):typeof i=="object"||!i?n.init.apply(this,arguments):e.error("Method "+i+" does not exist on jQuery.anim8")}}).call(this);