// Generated by CoffeeScript 1.3.3
/*
v: 0.0.4 alpha
*/(function(){var e,t,n,r=[].slice;(function(){var e,t,n,r,i;if(window.requestAnimationFrame)return;e=0,n=["ms","moz","webkit","o"];for(r=0,i=n.length;r<i;r++){t=n[r];if(window.requestAnimationFrame!=null)break;window.requestAnimationFrame=window[""+t+"RequestAnimationFrame"],window.cancelAnimationFrame=window[""+t+"CancelAnimationFrame"]||window[""+t+"CancelRequestAnimationFrame"]}return window.requestAnimationFrame==null&&(window.requestAnimationFrame=function(t,n){var r,i,s;return r=(new Date).getTime(),s=Math.max(0,16-(r-e)),i=window.setTimeout(function(){return t(r+s)},s),e=r+s,i}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){return clearTimeout(e)}),null})(),e=jQuery,t={cache:{},loadSheet:function(t){var n,r,i=this;return this.cache[t]==null&&(n=e.Deferred(),this.cache[t]=n.promise(),r=new Image,r.src=t,r.onload=function(){return n.resolve(r)},r.onerror=function(){return n.reject(t)},r.onabort=function(){return n.reject(t)}),this.cache[t]},loadIndex:function(t){var n;return this.cache[t]||(n=e.Deferred(),this.cache[t]=n.promise(),e.getJSON(t).done(function(e){return n.resolve(e)}).fail(function(e){return n.reject(e)})),this.cache[t]}},n={init:function(n){return this.each(function(){var r,i,s;r=e(this);if(r.data("anim8"))return;return s=e.extend({time:1,loop:"infinite",play:!0,offsetX:0,offsetY:0,index:null,sheet:null},n),r.data("index")!=null&&(s.index=r.data("index")),r.data("sheet")!=null&&(s.sheet=r.data("sheet")),r.data("time")!=null&&(s.time=parseFloat(r.data("time"))),r.data("offset-x")!=null&&(s.offsetX=parseInt(r.data("offset-x"))),r.data("offset-y")!=null&&(s.offsetY=parseInt(r.data("offset-y"))),r.data("loop")!=null&&(s.loop=parseInt(r.data("loop"))),s.index==null?e.error("No animation index"):s.sheet==null?e.error("No animation sheet"):(i={ready:!1,state:"stop",curFrame:0,lastTime:0,loopsRemaining:s.loop,offsetX:s.offsetX,offsetY:s.offsetY,sheet:null,index:null,frameCount:0,frameDelay:0},r.data("anim8",i),e.when(t.loadSheet(s.sheet),t.loadIndex(s.index)).done(function(e,t){return i.sheet=e,i.index=t,i.frameCount=t.frames.length,i.frameDelay=s.time*1e3/t.frames.length,i.ready=!0,s.play===!0?i.state="play":i.state="stop",r.trigger("anim8.ready"),r.anim8("draw")}))})},getData:function(){return e(this).data("anim8")},start:function(t){return t==null&&(t="infinite"),this.each(function(){var n;n=e(this).anim8("getData");if(!n.ready)return;return n.state="play",n.loopsRemaining=t,e(this).anim8("draw")})},stop:function(){return this.each(function(){var t;t=e(this).anim8("getData");if(!t.ready)return;return t.state="stop",e(this)})},reset:function(){return this.each(function(){return e(this).anim8("getData").curFrame=0,e(this).anim8("draw")})},draw:function(){return this.each(function(){var t,n,r,i,s;return t=e(this),s=t.data("anim8"),r=t.get(0),i=r.getContext("2d"),n=function(e){var o,u,a;if(s.lastTime>0&&e-s.lastTime<s.frameDelay){window.requestAnimationFrame(n);return}if(s.loopsRemaining!=="infinite"&&s.curFrame%s.frameCount===s.frameCount-1){s.loopsRemaining-=1;if(s.loopsRemaining===0)return s.state="stop",t}o=s.curFrame%s.frameCount,a=s.index.frames[o],u=a.spriteSourceSize,i.clearRect(0,0,r.width,r.height),i.drawImage(s.sheet,a.frame.x,a.frame.y,a.frame.w,a.frame.h,s.offsetX+u.x,s.offsetY+u.y,a.frame.w,a.frame.h),s.lastTime=e,s.curFrame+=1;if(s.state==="play")return window.requestAnimationFrame(n)},window.requestAnimationFrame(n)})}},e.fn.anim8=function(){var t,i;return i=arguments[0],t=2<=arguments.length?r.call(arguments,1):[],n[i]!=null?n[i].apply(this,t):typeof i=="object"||!i?n.init.apply(this,arguments):e.error("Method "+i+" does not exist on jQuery.anim8")}}).call(this);